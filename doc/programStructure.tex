\pagebreak
\section{Program Structure}

The file structure of \texttt{Grid2Grid} is shown in Fig. \ref{fig:Grid2Grid_file_structure}. The directory \texttt{config} contains the compiling rule for \texttt{makefile} not \texttt{cmake}. The directory \texttt{doc} constains \texttt{Grid2Grid} manual files. The directory \texttt{example} contains the examples for interface between other languages and \texttt{Grid2Grid}. The directory \texttt{src} includes the libraries and source file directory. The library used \texttt{Grid2Grid} are \texttt{libbspline} and \texttt{libFyMc}. The \texttt{libbspline} is b-spline interpolation library and \texttt{libFyMc} is a general Fortran library. The \texttt{libGrid2Grid} is the source code directory of \texttt{Grid2Grid} and it is composed of each modules which are sepated in a module directory with its sub-class(type) directories. 

\vspace{0.5em}
\begin{figure} [H]
\centering
\colorbox{gray!10}{\begin{minipage}{15.5cm}
\begin{forest}
	for tree={
		font=\ttfamily,
		grow'=0,
		child anchor=west,
		parent anchor=south,
		anchor=west,
		calign=first,
		inner xsep=7pt,
		edge path={
			\noexpand\path [draw, \forestoption{edge}]
			(!u.south west) +(7.5pt,0) |- (.child anchor) pic {folder} \forestoption{edge label};
		},
		before typesetting nodes={
			if n=1
			{insert before={[,phantom]}}
			{}
		},
		fit=band,
		before computing xy={l=15pt},
	}  
	[Grid2Grid
		[config]
		[doc]
		[example
			[fortGrid2Grid; Example for the interface between Fortran]
			[ofGrid2Grid; Example 1 for the interface between OpenFOAM]
			[ofGrid2GridDict; Example 2 for the interface between OpenFOAM]
		]
		[src
			[libBspline; b-spline module]
			[libFyMc; Fortran module for the general purpose]
			[libGrid2Grid
				[auxiliary] 
				[fftw3; FFTW3 library interface module]
				[HDF5; HDF5 library interface module]
				[surf2Vol; HOS wave field reconstruction module]
				[vol2Vol; HOS wave field interpolation module]
				[postGrid2Grid; post Grid2Grid Module ]
			]				
		]
	]
\end{forest}
\end{minipage}}
	\vspace{0.5em}
    \caption{Grid2Grid file structure}
	\label{fig:Grid2Grid_file_structure}
\end{figure}


The program structure of \texttt{Grid2Grid} is depicted in Fig. \ref{fig:grid2GridStructure}. The program is composed of several modules (\texttt{.f90}) with a suffix \texttt{mod}. HOS wave fields are generated by \texttt{modSurf2Vol} from the HOS result file (\texttt{modes\_HOS\_SWENSE.dat} or \texttt{modes\_HOS\_SWENSE.hdf5}). Since the results files only contains modes information, the volumic wave fields is reconstructed on the HOS grid by inverse FFTs (denoted as $H_2$ Operator). The volumic wave field in \texttt{Grid2Grid} at the certain time step is called as a snapshot of wave field. \texttt{modVol2Vol} constructs an interpolation data structure from several snapshots of wave field by using multidimensional spline module (\cite{BsplineWilliams}). \texttt{modVol2Vol} can directly compiled with other fortran program if the same Fortran compiler is used (gfortran>4.9.2). \texttt{modGrid2Grid} generates shared library named as \texttt{libGrid2Grid.so} to communicate with other languages. Standard program language rule \texttt{ISO\_C\_BINDING} is required to communicate with the library \texttt{Grid2Grid}. The examples are given in directory \texttt{example}. \texttt{modPostGrid2Grid} is a post processing module of \texttt{Grid2Grid} generating the HOS wave fields for the 3D visualization(VTK format) and the wave elevation time series.

\vspace{0.5em}
{
    \begin{figure} [H]
    \centering
    \includegraphics[scale=0.56, trim= 0.5cm 0cm 0cm 0cm, clip]{images/c1.structure/"g2g_programStructure_R2".png}
    \caption{Program Structure of \texttt{Grid2Grid}}
    \label{fig:grid2GridStructure}
    \end{figure}
}

\pagebreak

The main feature of each module is following.
\newline

{
\hspace{0.5 cm} -- \texttt{modSurf2Vol} : HOS-Ocean and NWT classes and reconstructed HOS wave fields

\hspace{0.5 cm} -- \texttt{modVol2Vol} : Interpolate reconstructed HOS wave fields 

\hspace{0.5 cm} -- \texttt{modGrid2Grid} : Communication with other language with \texttt{ISO\_C\_BINDING}

\hspace{0.5 cm} -- \texttt{modPostGrid2Grid} : Post processing of HOS (wave fields and elevation)

\hspace{0.5 cm} -- \texttt{modFourier\_r2c\_FFTW} : Interface module of \texttt{FFTW} open library

\hspace{0.5 cm} -- \texttt{modHDF5Interface} : Interface module of \texttt{HDF5} open library

\hspace{0.5 cm} -- \texttt{modGrid2GridGeneral} : Grid2Grid global variables and auxiliary functions

\hspace{0.5 cm} -- \texttt{libBspline} : Multidimensional b-spline module written in Fortran.

\hspace{0.5 cm} -- \texttt{libFyMc} : Auxiliary fortran functions (Dictionary, Character operation, ... )
}